{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  {% include 'dashboard/includes/meta.html' %}
  <title>{% block title %}لوحة التحكم{% endblock %}</title>
  {% include 'dashboard/includes/styles.html' %}
  {% block extra_head %}{% endblock %}
</head>
<body class="bg-light" data-theme="light">
  {% block navbar %}
    {% include 'dashboard/base/navbar.html' %}
  {% endblock %}

  <div class="dashboard-layout" style="margin-top: 76px;">
    {% block sidebar %}
      {% include 'dashboard/base/sidebar.html' %}
    {% endblock %}

    <main class="main-content">
      {% include 'dashboard/includes/messages.html' %}
      {% block content %}{% endblock %}
    </main>
  </div>

  {% block footer %}
    {% include 'dashboard/base/footer.html' %}
  {% endblock %}

  <!-- Enhanced Loading indicator -->
  <div id="loading-overlay" class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="z-index: 9999; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px);">
    <div class="text-center">
      <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">جاري التحميل...</span>
      </div>
      <div class="loading-text">
        <h5 class="text-primary mb-2">جاري التحميل...</h5>
        <p class="text-muted small mb-0">يرجى الانتظار</p>
      </div>
    </div>
  </div>
  
  <!-- Progress bar for page loading -->
  <div id="page-progress" class="position-fixed top-0 start-0 w-100" style="height: 3px; z-index: 9998; background: transparent;">
    <div class="progress-bar bg-primary" style="height: 100%; width: 0%; transition: width 0.3s ease;"></div>
  </div>

  {% include 'dashboard/includes/scripts.html' %}
  {% block extra_scripts %}{% endblock %}
  
  <!-- Performance and Enhancement Scripts -->
  <script>
    // Enhanced page loading progress
    (function() {
      const progressBar = document.querySelector('#page-progress .progress-bar');
      let progress = 0;
      
      function updateProgress(value) {
        if (progressBar) {
          progressBar.style.width = value + '%';
        }
      }
      
      // Simulate loading progress
      const interval = setInterval(() => {
        progress += Math.random() * 30;
        if (progress >= 90) {
          progress = 90;
          clearInterval(interval);
        }
        updateProgress(progress);
      }, 100);
      
      // Complete on load
      window.addEventListener('load', () => {
        updateProgress(100);
        setTimeout(() => {
          const progressContainer = document.getElementById('page-progress');
          if (progressContainer) {
            progressContainer.style.opacity = '0';
            setTimeout(() => {
              progressContainer.style.display = 'none';
            }, 300);
          }
        }, 500);
      });
    })();
    
    // Preload critical resources
    function preloadResources() {
      const criticalResources = [
        'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css',
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
      ];

      // Only preload Chart.js if a chart is present on the page
      const hasOrdersChart = !!document.getElementById('ordersByDayChart');
      if (hasOrdersChart) {
        criticalResources.push('https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js');
      }
      
      criticalResources.forEach(url => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = url;
        link.as = url.includes('.css') ? 'style' : 'script';
        if (link.as === 'script') link.crossOrigin = 'anonymous';
        document.head.appendChild(link);
      });
    }
    
    // Initialize preloading
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', preloadResources);
    } else {
      preloadResources();
    }
  </script>
</body>
</html>
