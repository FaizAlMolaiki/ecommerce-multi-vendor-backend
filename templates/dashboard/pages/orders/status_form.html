{% extends 'dashboard/layouts/form_layout.html' %}

{% block title %}تغيير حالة الطلب #{{ object.id }} - لوحة التحكم{% endblock %}

{% with page_title='تغيير حالة الطلب #'|add:object.id|stringformat:'s' %}
{% with form_title='تحديث حالة الطلب' %}
{% with form_icon='exchange-alt' %}
{% with back_url='/dashboard/orders/' %}
{% with submit_text='تحديث الحالة' %}

{% block form_content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h6 class="text-muted">معلومات الطلب الحالية</h6>
        <div class="border rounded p-3 bg-light">
            <p><strong>رقم الطلب:</strong> #{{ object.id }}</p>
            <p><strong>المستخدم:</strong> {{ object.user.email|default:"ضيف" }}</p>
            <p class="mb-1"><strong>حالة الدفع الحالية:</strong>
                {% if object.payment_status == 'PENDING_PAYMENT' %}
                    <span class="badge bg-warning">في انتظار الدفع</span>
                {% elif object.payment_status == 'PAID' %}
                    <span class="badge bg-success">مدفوع</span>
                {% elif object.payment_status == 'CANCELLED' %}
                    <span class="badge bg-danger">ملغي (دفع)</span>
                {% elif object.payment_status == 'REFUNDED' %}
                    <span class="badge bg-secondary">مسترجع</span>
                {% endif %}
            </p>
            <p><strong>حالة التجهيز/التسليم الحالية:</strong>
                {% if object.fulfillment_status == 'PENDING' %}
                    <span class="badge bg-info">قيد المراجعة</span>
                {% elif object.fulfillment_status == 'ACCEPTED' %}
                    <span class="badge bg-primary">تم القبول</span>
                {% elif object.fulfillment_status == 'PREPARING' %}
                    <span class="badge bg-primary">قيد التجهيز</span>
                {% elif object.fulfillment_status == 'SHIPPED' %}
                    <span class="badge bg-primary">تم الشحن</span>
                {% elif object.fulfillment_status == 'DELIVERED' %}
                    <span class="badge bg-success">تم التوصيل</span>
                {% elif object.fulfillment_status == 'REJECTED' %}
                    <span class="badge bg-danger">مرفوض</span>
                {% endif %}
            </p>
            <p><strong>الإجمالي:</strong> {{ object.grand_total }} ريال</p>
        </div>
    </div>
    <div class="col-md-6">
        <h6 class="text-muted">الحالات الجديدة</h6>
        {% include 'dashboard/components/forms/form_field.html' with field=form.payment_status label='حالة الدفع' required=True %}
        {% include 'dashboard/components/forms/form_field.html' with field=form.fulfillment_status label='حالة التجهيز/التسليم' required=True %}
    </div>
    
</div>

<div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>
    <strong>ملاحظة:</strong> سيتم تحديث حالتي الطلب (الدفع والتجهيز/التسليم).
</div>
{% endblock %}

{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
