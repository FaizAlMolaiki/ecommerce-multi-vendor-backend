{% extends 'dashboard/layouts/list_layout.html' %}

{% block title %}المستخدمين - لوحة التحكم{% endblock %}

{% with page_title='إدارة المستخدمين' %}
{% with create_url='/dashboard/users/create/' %}
{% with show_filters=True %}

{% block filters %}
    {{ block.super }}
    <div class="col-md-3">
        <label class="form-label">البريد</label>
        <input type="text" name="email" class="form-control" value="{{ filters.email }}" placeholder="user@example.com">
    </div>
    <div class="col-md-2">
        <label class="form-label">نشط؟</label>
        <select name="is_active" class="form-select">
            <option value="">الكل</option>
            <option value="1" {% if filters.is_active == '1' %}selected{% endif %}>نعم</option>
            <option value="0" {% if filters.is_active == '0' %}selected{% endif %}>لا</option>
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">موظف؟</label>
        <select name="is_staff" class="form-select">
            <option value="">الكل</option>
            <option value="1" {% if filters.is_staff == '1' %}selected{% endif %}>نعم</option>
            <option value="0" {% if filters.is_staff == '0' %}selected{% endif %}>لا</option>
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">بائع؟</label>
        <select name="is_vendor" class="form-select">
            <option value="">الكل</option>
            <option value="1" {% if filters.is_vendor == '1' %}selected{% endif %}>نعم</option>
            <option value="0" {% if filters.is_vendor == '0' %}selected{% endif %}>لا</option>
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">مندوب؟</label>
        <select name="is_delivery" class="form-select">
            <option value="">الكل</option>
            <option value="1" {% if filters.is_delivery == '1' %}selected{% endif %}>نعم</option>
            <option value="0" {% if filters.is_delivery == '0' %}selected{% endif %}>لا</option>
        </select>
    </div>
{% endblock %}

{% block table_headers %}
    <th><i class="fas fa-hashtag me-1"></i>المعرف</th>
    <th><i class="fas fa-user me-1"></i>المستخدم</th>
    <th><i class="fas fa-envelope me-1"></i>البريد الإلكتروني</th>
    <th><i class="fas fa-user-tag me-1"></i>الأدوار</th>
    <th><i class="fas fa-toggle-on me-1"></i>الحالة</th>
    <th><i class="fas fa-shield-alt me-1"></i>التحقق</th>
    <th><i class="fas fa-clock me-1"></i>تاريخ التسجيل</th>
    <th><i class="fas fa-cog me-1"></i>الإجراءات</th>
{% endblock %}

{% block table_row %}
    <td>#{{ object.id }}</td>
    <td>
        <div class="d-flex align-items-center">
            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                {{ object.name.0|default:object.email.0|upper }}
            </div>
            <div>
                <div class="fw-bold">
                    {{ object.name|default:object.email|truncatechars:20 }}
                </div>
                {% if object.phone_number %}
                <small class="text-muted">{{ object.phone_number }}</small>
                {% endif %}
            </div>
        </div>
    </td>
    <td>{{ object.email }}</td>
    <td>
        <div>
            {% if object.is_staff %}
                <span class="badge bg-danger me-1">موظف</span>
            {% endif %}
            {% if object.is_vendor %}
                <span class="badge bg-success me-1">بائع</span>
            {% endif %}
            {% if object.is_delivery %}
                <span class="badge bg-info me-1">مندوب</span>
            {% endif %}
            {% if not object.is_staff and not object.is_vendor and not object.is_delivery %}
                <span class="badge bg-secondary">عميل</span>
            {% endif %}
        </div>
    </td>
    <td>
        {% if object.is_active %}
            <span class="badge bg-success">مفعل</span>
        {% else %}
            <span class="badge bg-secondary">معطل</span>
        {% endif %}
    </td>
    <td>
        {% if object.is_verified %}
            <span class="badge bg-success">
                <i class="fas fa-check me-1"></i>محقق
            </span>
        {% else %}
            <span class="badge bg-warning">
                <i class="fas fa-clock me-1"></i>غير محقق
            </span>
        {% endif %}
    </td>
    <td>{{ object.created_at|date:"Y-m-d" }}</td>
    <td>
        {% include 'dashboard/components/tables/action_buttons.html' with object=object detail_url='/dashboard/users/' edit_url='/dashboard/users/' delete_url='/dashboard/users/' %}
        <a href="/dashboard/users/{{ object.id }}/reset-password/" class="btn btn-sm btn-outline-info ms-1" title="إعادة تعيين كلمة المرور">
            <i class="fas fa-key"></i>
        </a>
    </td>
{% endblock %}

{% endwith %}
{% endwith %}
{% endwith %}
